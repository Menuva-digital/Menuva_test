<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reserve Room</title>
<style>
/* ===================== RESET & THEME ===================== */
* { box-sizing: border-box; margin:0; padding:0; }

:root {
  --bg: #1e3c72;          /* biru elegan buat background */
  --surface: #ffffff;
  --text: #1c2d4f;
  --muted: #5c6f91;
  --border: #c3d4f7;
  --primary: #1f70ff;
  --success: #25d366;
  --card-light: #ffffff;
  --card-dark: #1c2333;
  --chip: #dce7ff;        /* ‚úÖ tambahin ini buat default terang */
  --shadow: 0 6px 24px rgba(0,0,0,.08);
}

body.dark {
  --bg: #0e1116;
  --surface: #141922;
  --text: #e6ebff;
  --muted: #aab6db;
  --border: #263148;
  --primary: #4da3ff;
  --chip: #0f1a2a;
  --shadow: 0 8px 28px rgba(0,0,0,.5);
}

body {
  font-family: system-ui, sans-serif;
  background: var(--bg);  /* gak perlu !important kalau variablenya fix */
  color: var(--text);
  transition: background .3s, color .3s;
  padding-bottom: 50px;
}

header {
  position: relative;
  text-align: center;
  padding: 16px 20px;
}

header .header-inner {
  display: flex;
  justify-content: center; /* konten utama di tengah */
  align-items: center;
  position: relative;
}

header .center-info {
  display: flex;
  flex-direction: column; /* Biar logo di atas, teks di bawah */
  align-items: center;
  gap: 6px;
}

header img#restoLogo {
  width: 70px;
  height: 70px;
  object-fit: contain;
  border-radius: 8px;
}

header h1 {
  font-size: 1.2rem;
  margin: 0;
  color: var(--text, #fff);
}

header .contact-info {
  font-size: 0.8rem;
  color: var(--text, #fff);
  line-height: 1.3;
}
header .dark-toggle {
  position: absolute;
  right: 20px;
  top: 20px;            /* lebih naik */
  transform: none;      /* buang translate biar patok ke atas */
  font-size: 1.3rem;
  cursor: pointer;
  background: none;
  border: none;
  color: var(--text, #fff);
}
.fixed-bar {
  position: fixed;       /* kalau mau selalu nempel bawah */
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;         /* kunci supaya button sejajar */
  justify-content: space-between;
  gap: 10px;             /* jarak antar tombol */
  padding: 10px;
  background: linear-gradient(135deg,#1e3c72,#2a5298);
}

.fixed-bar button {
  flex: 1;               /* ukuran sama rata */
  padding: 12px 0;
  font-size: 0.9rem;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  color: #fff;
}

.btn-wa {
  background: var(--success);
}

.btn-back {
  background: #d8cd33;
  color: #000;
}

  #restoName,
.contact-info,
.contact-info div {
  color: #ffffff !important;  /* paksa putih bersih */
}

  /* ===================== MAIN CONTAINER ===================== */
  .main-container {
    width: 95%;
    max-width: 900px;
    margin: 20px auto;
    background: var(--card-light);
    border-radius: 10px;
    padding: 16px;
    box-shadow: var(--shadow);
    transition: background .3s, color .3s;
  }
  body.dark .main-container { background: var(--card-dark); }
  
.tabs {
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* selalu 3 kolom */
  gap: 10px;
  margin-bottom: 16px;
}

.tabs button {
  width: 100%;
  padding: 10px 16px;
  border-radius: 999px;      /* bikin oval/pill */
  border: 1px solid #ccc;
  cursor: pointer;
  background: #f5f5f5;
  font-size: 0.95rem;
  font-weight: 500;
  transition: all 0.3s ease;
}

/* efek hover */
.tabs button:hover {
  background: #e0e0e0;
}

/* tab aktif */
.tabs button.active {
  background: #007bff;
  color: #fff;
  border-color: #007bff;
}

  /* ===================== GRID ===================== */
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(140px,1fr));
    gap: 12px;
  }
  .hidden { display: none; }

  /* ===================== ROOM CARD ===================== */
  .room-card {
    background: var(--card-light);
    border-radius: 10px;
    padding: 10px;
    text-align: center;
    font-size: 0.85rem;
    border: 1px solid #ddd;
    transition: background .3s, color .3s;
  }
  body.dark .room-card { background: var(--card-dark); border-color: #444; }
  .room-card img { width: 100%; height: 100px; object-fit: cover; border-radius: 6px; margin-bottom: 6px; }
  .room-card h3 { font-size: 0.95rem; margin: 4px 0; }
  .room-card p { margin: 2px 0; font-size: 0.8rem; }
  .room-card button {
    margin-top: 6px;
    padding: 6px 10px;
    font-size: 0.8rem;
    background: var(--success);
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }

  /* ===================== RESERVASI FORM ===================== */
  .reservasi-container { margin-top: 20px; }
  #cartPreview { background: var(--chip); padding: 10px; border-radius: 8px; margin-bottom: 8px; font-size: 0.85rem; }
  .cart-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; gap: 4px; flex-wrap: wrap; }

  .form-input {
    display: flex;
    flex-direction: column;
    margin-bottom: 10px;
  }
  .form-input label { font-size: 0.85rem; margin-bottom: 4px; }
  .form-input input,
  .form-input textarea {
    padding: 6px 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 0.85rem;
    width: 100%;
  }
  .form-input textarea { resize: vertical; min-height: 60px; }
 
  /* ===================== RESPONSIVE ===================== */
  @media (max-width: 500px) {
    header .header-inner { flex-direction: column; align-items: flex-start; gap: 6px; }
    header h1 { font-size: 1rem; }
    .room-card img { height: 80px; }
  }
/* Cart Item */
.cart-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--surface, #f8f8f8);
  border: 1px solid var(--border, #ddd);
  border-radius: 12px;
  padding: 8px 12px;
  margin: 6px 0;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  font-size: 14px;
  color: var(--text, #333);
  flex-wrap: wrap; /* biar responsif kalau sempit */
}

/* Kontainer tombol qty biar sejajar */
.qty-controls {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-left: auto;
}

/* Tombol umum ( + / - ) */
.qty-controls button {
  background: linear-gradient(145deg, #4e73df, #224abe);
  color: #fff;
  border: none;
  border-radius: 20px;
  padding: 6px 12px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  transition: all 0.2s ease-in-out;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
}

.qty-controls button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 10px rgba(0,0,0,0.25);
  background: linear-gradient(145deg, #5a82f0, #2d4fd1);
}

/* Tombol hapus ‚ùå lebih kecil */
.cart-item .remove-btn {
  background: linear-gradient(145deg, #e74c3c, #c0392b);
  border-radius: 50%;
  width: 28px;
  height: 28px;
  font-size: 14px;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-left: 8px;
}

.cart-item .remove-btn:hover {
  background: linear-gradient(145deg, #ff6655, #e74c3c);
}
#loadingIndicator {
  display: none;
}
#loadingIndicator.active {
  display: block;
  animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

</style>
</head>
<body>
<header>
  <div class="header-inner">
    <div class="center-info">
      <img id="restoLogo" alt="Logo" />
      <h1 id="restoName">Resto Name</h1>
      <div class="contact-info">
        <div id="alamatRestoranDisplay"></div>
        <div id="teleponRestoranDisplay"></div>
      </div>
    </div>
    <button class="dark-toggle" onclick="toggleDark()">üåô</button>
  </div>
</header>
<div id="loadingIndicator" style="text-align:center; padding:20px; font-size:0.9rem; color:#666;">
  ‚è≥ Loading data...
</div>

<div class="main-container" id="app">
  <!-- Tabs -->
  <div class="tabs">
    <button class="active" data-target="rooms">Rooms</button>
    <button data-target="meetings">Meeting Rooms</button>
    <button data-target="packages">Packages</button>
  </div>

  <!-- Grid -->
  <section id="rooms" class="grid"></section>
  <section id="meetings" class="grid hidden"></section>
  <section id="packages" class="grid hidden"></section>
  <p id="empty" class="hidden" style="text-align:center;color:#666;margin-top:8px">Data Empty.</p>

  <!-- Cart + Form -->
  <div class="reservasi-container">
    <div id="cartPreview"><p><i>No choice</i></p></div>
    <p id="cartTotal">Total: 0</p>
    <br>
    <div class="form-input"><label>Orderer Name</label><input type="text" id="custName"></div>
    <div class="form-input"><label>Address</label><input type="text" id="custAddress"></div>
    <div class="form-input"><label>Telephone Number</label><input type="text" id="custPhone"></div>
    <div class="form-input"><label>Date Used</label><input type="date" id="custDate"></div>
    <div class="form-input"><label>Notes</label><textarea id="custNote"></textarea></div>

   <!-- Bottom Buttons -->
<div class="fixed-bar">
  <button class="btn-wa" id="btnSend">üì§ Send Request</button>
  <button class="btn-back" onclick="history.back()">üîô Back To Menu</button>
</div>
</div>
</div>
<script>
(() => {
  const DB_NAME = "MenuvaDB";
  const STORE_NAME = "menuvaData";
  const DB_VERSION = 2;
  let db = null;
  let restoData = {};
  let cart = [];

  // ---------- helpers ----------
  function getEl(id) {
    const el = document.getElementById(id);
    if (!el) console.debug(`[room] getEl: #${id} not found`);
    return el;
  }
  function safeText(id, text) {
    const el = getEl(id);
    if (el) el.textContent = text;
  }
  function safeHTML(id, html) {
    const el = getEl(id);
    if (el) el.innerHTML = html;
  }

  // ---------- DB ----------
  function initDB() {
    return new Promise((resolve, reject) => {
      const req = indexedDB.open(DB_NAME, DB_VERSION);
      req.onerror = () => reject(req.error);
      req.onsuccess = (e) => {
        db = e.target.result;
        resolve(db);
      };
      // minimal onupgradeneeded - create store only if missing (safe)
      req.onupgradeneeded = (e) => {
        db = e.target.result;
        if (!db.objectStoreNames.contains(STORE_NAME)) {
          db.createObjectStore(STORE_NAME, { keyPath: "restoId" });
          console.log("[room] created fallback objectStore", STORE_NAME);
        }
      };
    });
  }

  async function loadDataFromDB() {
    if (!db) return {};
    if (!db.objectStoreNames.contains(STORE_NAME)) {
      console.warn("[room] store not found:", STORE_NAME);
      return {};
    }
    return new Promise((resolve) => {
      try {
        const tx = db.transaction(STORE_NAME, "readonly");
        const store = tx.objectStore(STORE_NAME);
        const req = store.getAll(); // ambil semua, pilih record pertama yang valid
        req.onsuccess = () => {
          const all = req.result || [];
          if (all.length === 0) return resolve({});
          const found = all.find(r => r && (r.restoId || r.restoPhone)) || all[0];
          resolve(found || {});
        };
        req.onerror = () => {
          console.warn("[room] getAll error:", req.error);
          resolve({});
        };
      } catch (err) {
        console.error("[room] loadDataFromDB exception:", err);
        resolve({});
      }
    });
  }

  // ---------- theme ----------
  function applyTheme() {
    const saved = localStorage.getItem('menuva_theme');
    const btn = getEl('darkToggle') || document.querySelector('.dark-toggle');
    if (saved === 'dark') document.body.classList.add('dark'); else document.body.classList.remove('dark');
    if (btn) btn.textContent = document.body.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
  }
  function toggleDark() {
    document.body.classList.toggle('dark');
    localStorage.setItem('menuva_theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    const btn = getEl('darkToggle') || document.querySelector('.dark-toggle');
    if (btn) btn.textContent = document.body.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
  }

  // ---------- cart helpers ----------
  function updateCart() {
    const preview = getEl("cartPreview");
    const totalEl = getEl("cartTotal");
    if (!preview) {
      console.debug("[room] cartPreview not found");
      return;
    }
    if (cart.length === 0) {
      preview.innerHTML = "<p><i>There are no selected items.</i></p>";
      if (totalEl) totalEl.innerText = "Total: 0";
      return;
    }
    preview.innerHTML = "";
    let total = 0;
    cart.forEach((item, idx) => {
      const subtotal = (Number(item.harga) || 0) * (Number(item.qty) || 0);
      total += subtotal;
      const div = document.createElement("div");
      div.className = "cart-item";
      div.innerHTML = `
        <span>${escapeHtml(item.nama)} - ${(Number(item.harga)||0).toLocaleString()} x ${item.qty} = <b>${subtotal.toLocaleString()}</b></span>
      `;
      if (item.kategori === "package") {
        const ctrl = document.createElement("div");
        ctrl.className = "qty-controls";
        const btnDec = document.createElement("button");
        btnDec.textContent = "-";
        btnDec.onclick = () => { ubahQty(idx, -1); };
        const spanQty = document.createElement("span"); spanQty.textContent = item.qty;
        const btnInc = document.createElement("button");
        btnInc.textContent = "+";
        btnInc.onclick = () => { ubahQty(idx, 1); };
        ctrl.appendChild(btnDec); ctrl.appendChild(spanQty); ctrl.appendChild(btnInc);
        div.appendChild(ctrl);
      }
      const removeBtn = document.createElement("button");
      removeBtn.className = "remove-btn";
      removeBtn.textContent = "X";
      removeBtn.onclick = () => { hapusDariCart(idx); };
      div.appendChild(removeBtn);
      preview.appendChild(div);
    });
    if (totalEl) totalEl.innerText = "Total: " + total.toLocaleString();
  }

  function tambahKeCart(room) {
    if (!room || !room.nama) return;
    const idx = cart.findIndex(r => r.nama === room.nama);
    if (idx >= 0) cart[idx].qty = (cart[idx].qty || 0) + 1;
    else cart.push({ ...room, qty: 1 });
    updateCart();
  }
  function hapusDariCart(i) { cart.splice(i, 1); updateCart(); }
  function ubahQty(i, d) { cart[i].qty += d; if (cart[i].qty < 1) cart[i].qty = 1; updateCart(); }

  // ---------- safe escape ----------
  function escapeHtml(str) {
    if (str === null || str === undefined) return '';
    return String(str)
      .replace(/&/g,'&amp;')
      .replace(/"/g,'&quot;')
      .replace(/'/g,'&#39;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;');
  }

  // ---------- room card builder (DOM element) ----------
  function createRoomCard(room = {}) {
    const card = document.createElement('div');
    card.className = 'room-card';
    // image
    const img = document.createElement('img');
    img.alt = room.nama || '';
    if (room.image) img.src = room.image;
    else img.style.display = 'none';
    card.appendChild(img);
    // title
    const h3 = document.createElement('h3');
    h3.textContent = room.nama || '';
    card.appendChild(h3);
    // price
    const pPrice = document.createElement('p');
    pPrice.innerHTML = `<b>Price:</b> ${(Number(room.harga)||0).toLocaleString()}`;
    card.appendChild(pPrice);
    // capacity
    const pCap = document.createElement('p');
    pCap.innerHTML = `<b>Capacity:</b> ${room.kapasitas || 0} person`;
    card.appendChild(pCap);
    // size
    const pLuas = document.createElement('p');
    pLuas.innerHTML = `<b>Room size:</b> ${room.luas || 0} m¬≤`;
    card.appendChild(pLuas);
    // desc
    const pDesc = document.createElement('p');
    pDesc.textContent = room.deskripsi || '';
    card.appendChild(pDesc);
    // add button
    const btn = document.createElement('button');
    btn.textContent = 'Add To Cart';
    btn.onclick = () => tambahKeCart(room);
    card.appendChild(btn);

    return card;
  }

  // ---------- display data ----------
  function tampilkanData() {
    if (!restoData || !restoData.namaRestoran) {
      const emptyEl = getEl("empty");
      if (emptyEl) emptyEl.classList.remove("hidden");
      console.warn("[room] no restoData found or namaRestoran missing");
      return;
    }

    // header: set only if elements exist
    const logoEl = getEl("restoLogo");
    if (logoEl) {
      if (restoData.logo) {
        logoEl.src = restoData.logo;
        logoEl.style.display = '';
        logoEl.onerror = () => { logoEl.style.display = 'none'; };
      } else {
        logoEl.style.display = 'none';
      }
    }
    safeText("namaRestoranDisplay", restoData.namaRestoran || '');
    safeText("alamatRestoranDisplay", restoData.restoAddress || '');
    safeText("teleponRestoranDisplay", restoData.restoPhone || '');

    // grids
    const gridRooms = getEl("rooms");
    const gridMeetings = getEl("meetings");
    const gridPackages = getEl("packages");

    if (gridRooms) gridRooms.innerHTML = '';
    if (gridMeetings) gridMeetings.innerHTML = '';
    if (gridPackages) gridPackages.innerHTML = '';

    let total = 0;
    (Array.isArray(restoData.rooms) ? restoData.rooms : []).forEach(room => {
      total++;
      const card = createRoomCard(room);
      if (room.kategori === "hotel") {
        if (gridRooms) gridRooms.appendChild(card);
        else console.debug("[room] gridRooms not found, skipping room", room.nama);
      } else if (room.kategori === "meeting") {
        if (gridMeetings) gridMeetings.appendChild(card);
        else console.debug("[room] gridMeetings not found, skipping meeting", room.nama);
      } else if (room.kategori === "package") {
        if (gridPackages) gridPackages.appendChild(card);
        else console.debug("[room] gridPackages not found, skipping package", room.nama);
      } else {
        // fallback: append to rooms if no kategori match
        if (gridRooms) gridRooms.appendChild(card);
      }
    });

    const emptyIndicator = getEl("empty");
    if (emptyIndicator) emptyIndicator.classList.toggle("hidden", total > 0);
  }

  // ---------- tabs ----------
  function setupTabs() {
    const tabButtons = document.querySelectorAll(".tabs button");
    if (!tabButtons || tabButtons.length === 0) return;
    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        tabButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        document.querySelectorAll(".grid").forEach(sec => sec.classList.add("hidden"));
        const targetId = btn.dataset.target;
        const target = getEl(targetId);
        if (target) target.classList.remove("hidden");
      });
    });
  }

  // ---------- WhatsApp ----------
  function setupWA() {
    const btnSend = getEl("btnSend");
    if (!btnSend) {
      console.debug("[room] btnSend not found; skipping WA setup");
      return;
    }
    btnSend.addEventListener("click", () => {
      const adminNos = restoData.nomorWaAdmin;
      if (!adminNos || (Array.isArray(adminNos) && adminNos.length === 0) || (!Array.isArray(adminNos) && String(adminNos).trim() === "")) {
        alert("Admin's WhatsApp number has not been set.");
        return;
      }
      if (cart.length === 0) { alert("Cart is still empty."); return; }
      const adminNo = (Array.isArray(adminNos) ? adminNos[0] : adminNos).replace(/[^0-9]/g, "");
      let pesan = `Hello ${restoData.namaRestoran || "Admin"}, I want a reservation:\n\n`;
      cart.forEach((item, i) => {
        pesan += `${i+1}. ${item.nama} - ${(Number(item.harga)||0).toLocaleString()} x ${item.qty} = ${((Number(item.harga)||0)*item.qty).toLocaleString()}\n`;
      });
      const total = cart.reduce((a, b) => a + ((Number(b.harga)||0) * (b.qty||0)), 0);
      pesan += `\nTotal: ${total.toLocaleString()}\n\n`;
      const custName = (getEl("custName") && getEl("custName").value) || "";
      const custAddress = (getEl("custAddress") && getEl("custAddress").value) || "";
      const custPhone = (getEl("custPhone") && getEl("custPhone").value) || "";
      const custDate = (getEl("custDate") && getEl("custDate").value) || "";
      const custNote = (getEl("custNote") && getEl("custNote").value) || "";
      pesan += `Name: ${custName}\nAddress: ${custAddress}\nPhone Number: ${custPhone}\nDate: ${custDate}\nNotes: ${custNote}\n`;
      window.open(`https://wa.me/${adminNo}?text=${encodeURIComponent(pesan)}`, "_blank");
    });
  }

  // ---------- init ----------
  document.addEventListener("DOMContentLoaded", async () => {
    applyTheme();
    const ld = getEl("loadingIndicator");
    if (ld) ld.classList.add("active");

    try {
      await initDB();
      restoData = await loadDataFromDB();
    } catch (err) {
      console.error("[room] DB init/load failed:", err);
    }

    // wire dark toggle button if exists
    const dt = getEl('darkToggle') || document.querySelector('.dark-toggle');
    if (dt) dt.addEventListener('click', toggleDark);

    tampilkanData();
    setupTabs();
    setupWA();
    updateCart();

    if (ld) ld.classList.remove("active");
  });

})();
</script>


</body>
</html>


