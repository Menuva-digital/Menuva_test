<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reserve Room</title>
<style>
/* ===================== RESET & THEME ===================== */
* { box-sizing: border-box; margin:0; padding:0; }

:root {
  --bg: #1e3c72;
  --surface: #ffffff;
  --text: #1c2d4f;
  --muted: #5c6f91;
  --border: #c3d4f7;
  --primary: #1f70ff;
  --success: #25d366;
  --card-light: #ffffff;
  --card-dark: #1c2333;
  --chip: #dce7ff;
  --shadow: 0 6px 24px rgba(0,0,0,.08);
}

body.dark {
  --bg: #0e1116;
  --surface: #141922;
  --text: #e6ebff;
  --muted: #aab6db;
  --border: #263148;
  --primary: #4da3ff;
  --chip: #0f1a2a;
  --shadow: 0 8px 28px rgba(0,0,0,.5);
}

body {
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  transition: background .3s, color .3s;
  padding-bottom: 60px;
}

/* ===================== HEADER ===================== */
header {
  position: relative;
  text-align: center;
  padding: 16px 20px;
}
header .header-inner {
  display: flex;
  justify-content: center;
  align-items: center;
}
header .center-info {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
}
header img#restoLogo {
  width: 70px; height: 70px;
  object-fit: contain;
  border-radius: 8px;
}
header h1 { font-size: 1.2rem; margin: 0; color: var(--text); }
header .contact-info { font-size: 0.8rem; line-height: 1.3; color: var(--text); }

.header-right {
  position: absolute;
  top: 12px;
  right: 20px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  align-items: flex-end;
}
.dark-toggle {
  background: none; border: none;
  font-size: 1.2rem; cursor: pointer;
  color: var(--text);
}
.locale-select {
  padding: 4px 6px;
  font-size: 0.9rem;
}

/* ===================== MAIN CONTAINER ===================== */
.main-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 1rem;
  background-color: rgba(238, 241, 245, 0.384); /* biru lembut, transparan */
  border-radius: 8px;
}
@media (max-width:768px) {
  .main-container { padding: 0.5rem; }
}
@media (min-width:1400px) {
  .main-container { max-width: 1400px; }
}

/* ===================== TABS ===================== */
.tabs {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-bottom: 16px;
}
.tabs button {
  padding: 10px;
  border-radius: 999px;
  border: 1px solid #ccc;
  background: #f5f5f5;
  cursor: pointer;
  transition: .3s;
}
.tabs button.active { background:#007bff; color:#fff; }

/* ===================== GRID & CARD ===================== */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill,minmax(150px,1fr));
  gap: 12px;
}
.room-card {
  background: var(--card-light);
  border-radius: 10px;
  padding: 10px;
  text-align: center;
  font-size: 0.85rem;
  border: 1px solid #ddd;
  transition: .3s;
}
body.dark .room-card { background: var(--card-dark); border-color:#444; }
.room-card img { width:100%; height:100px; object-fit:cover; border-radius:6px; margin-bottom:6px; }
.room-card h3 { margin: 4px 0; font-size:0.95rem; }
.room-card p { margin: 2px 0; font-size:0.8rem; }
.room-card button {
  margin-top:6px; padding:6px 10px;
  background: var(--success); color:#fff;
  border:none; border-radius:6px; cursor:pointer;
}

/* ===================== CART & FORM ===================== */
#cartPreview { background:var(--chip); padding:10px; border-radius:8px; margin-bottom:8px; font-size:0.85rem; }
.cart-item {
  display:flex; justify-content:space-between; align-items:center;
  background: var(--surface);
  border:1px solid var(--border);
  border-radius:10px;
  padding:6px 10px; margin:6px 0;
}
.qty-controls { display:flex; gap:6px; }
.qty-controls button {
  background:#224abe; color:#fff;
  border:none; border-radius:20px;
  padding:4px 10px; cursor:pointer;
}
.remove-btn {
  background:#c0392b; color:#fff;
  border:none; border-radius:50%;
  width:24px; height:24px; cursor:pointer;
}

/* ===================== FIXED BAR ===================== */
.fixed-bar {
  position: fixed;
  bottom:0; left:0; right:0;
  display:flex; gap:10px;
  padding:10px;
  background:linear-gradient(135deg,#1e3c72,#2a5298);
}
.fixed-bar button {
  flex:1; padding:12px;
  border:none; border-radius:8px;
  font-size:0.9rem; cursor:pointer;
  color:#fff;
}
.btn-wa { background: var(--success); }
.btn-back { background:#d8cd33; color:#000; }
</style>
</head>
<body>
<header>
  <div class="header-inner">
    <div class="center-info">
      <img id="restoLogo" alt="Logo"/>
      <h1 id="restoName">Resto Name</h1>
      <div class="contact-info">
        <div id="alamatRestoranDisplay"></div>
        <div id="teleponRestoranDisplay"></div>
      </div>
    </div>
  </div>
  <div class="header-right">
    <button id="darkToggle" class="dark-toggle">üåô</button>
    <select id="localeSelect" class="locale-select">
      <option value="auto">Auto</option>
      <option value="id-ID|IDR">IDR</option>
      <option value="en-US|USD">USD</option>
      <option value="en-GB|GBP">GBP</option>
      <option value="ja-JP|JPY">JPY</option>
    </select>
  </div>
</header>

<div id="loadingIndicator" style="text-align:center;padding:20px;color:#888;display:none">‚è≥ Loading...</div>

<div class="main-container">
  <div class="tabs">
    <button class="active" data-target="rooms">Rooms</button>
    <button data-target="meetings">Meeting Rooms</button>
    <button data-target="packages">Packages</button>
  </div>

  <section id="rooms" class="grid"></section>
  <section id="meetings" class="grid hidden"></section>
  <section id="packages" class="grid hidden"></section>
  <p id="empty" class="hidden" style="text-align:center;margin-top:8px">Data Empty</p>

  <div class="reservasi-container">
    <div id="cartPreview"><p><i>No choice</i></p></div>
    <p id="cartTotal">Total: 0</p>
    <div class="form-input"><label>Name</label><input id="custName"/></div>
    <div class="form-input"><label>Address</label><input id="custAddress"/></div>
    <div class="form-input"><label>Phone</label><input id="custPhone"/></div>
    <div class="form-input"><label>Date</label><input type="date" id="custDate"/></div>
    <div class="form-input"><label>Notes</label><textarea id="custNote"></textarea></div>
  </div>
</div>

<div class="fixed-bar">
  <button class="btn-wa" id="btnSend">üì§ Send</button>
  <button class="btn-back" onclick="history.back()">üîô Back</button>
</div>

<script>
(() => {
  const DB_NAME = "MenuvaDB", STORE_NAME = "menuvaData", DB_VERSION = 2;
  let db=null, restoData={}, cart=[];
  let currentLocale=navigator.language||"id-ID", currentCurrency="IDR";

  const el=id=>document.getElementById(id);
  const formatCurrency=num=>{
    try {
      return new Intl.NumberFormat(currentLocale,{style:"currency",currency:currentCurrency,minimumFractionDigits:0}).format(num||0);
    } catch { return (num||0).toLocaleString(); }
  };

  // ---------- THEME ----------
  function applyTheme(){
    const saved=localStorage.getItem("menuva_theme");
    if(saved==="dark") document.body.classList.add("dark"); else document.body.classList.remove("dark");
    el("darkToggle").textContent=document.body.classList.contains("dark")?"‚òÄÔ∏è":"üåô";
  }
  function toggleDark(){
    document.body.classList.toggle("dark");
    localStorage.setItem("menuva_theme",document.body.classList.contains("dark")?"dark":"light");
    applyTheme();
  }

  // ---------- DB ----------
  function initDB(){
    return new Promise((res,rej)=>{
      const req=indexedDB.open(DB_NAME,DB_VERSION);
      req.onerror=()=>rej(req.error);
      req.onsuccess=e=>{ db=e.target.result; res(db); };
      req.onupgradeneeded=e=>{
        db=e.target.result;
        if(!db.objectStoreNames.contains(STORE_NAME)) db.createObjectStore(STORE_NAME,{keyPath:"restoId"});
      };
    });
  }
  function loadDataFromDB(){
    return new Promise(resolve=>{
      if(!db||!db.objectStoreNames.contains(STORE_NAME)) return resolve({});
      const tx=db.transaction(STORE_NAME,"readonly");
      const store=tx.objectStore(STORE_NAME);
      const req=store.getAll();
      req.onsuccess=()=>resolve(req.result[0]||{});
      req.onerror=()=>resolve({});
    });
  }

  // ---------- RENDER ----------
  function createRoomCard(room){
    const c=document.createElement("div"); c.className="room-card";
    if(room.image){ const img=new Image(); img.src=room.image; c.appendChild(img);}
    const h3=document.createElement("h3"); h3.textContent=room.nama||""; c.appendChild(h3);
    c.innerHTML+=`<p><b>Price:</b> ${formatCurrency(room.harga||0)}</p>`;
    c.innerHTML+=`<p><b>Capacity:</b> ${room.kapasitas||0}</p>`;
    const b=document.createElement("button"); b.textContent="Add To Cart"; b.onclick=()=>tambahKeCart(room); c.appendChild(b);
    return c;
  }
  function tampilkanData(){
    if(!restoData.namaRestoran){ el("empty").classList.remove("hidden"); return; }
    if(restoData.logo){ el("restoLogo").src=restoData.logo; }
    el("restoName").textContent=restoData.namaRestoran||"";
    el("alamatRestoranDisplay").textContent=restoData.restoAddress||"";
    el("teleponRestoranDisplay").textContent=restoData.restoPhone||"";
    ["rooms","meetings","packages"].forEach(id=>el(id).innerHTML="");
    (restoData.rooms||[]).forEach(r=>{
      if(r.kategori==="meeting") el("meetings").appendChild(createRoomCard(r));
      else if(r.kategori==="package") el("packages").appendChild(createRoomCard(r));
      else el("rooms").appendChild(createRoomCard(r));
    });
    el("empty").classList.toggle("hidden",(restoData.rooms||[]).length>0);
  }

  // ---------- CART ----------
  function updateCart(){
    const preview=el("cartPreview"); preview.innerHTML="";
    if(cart.length===0){ preview.innerHTML="<p><i>No choice</i></p>"; el("cartTotal").textContent="Total:0"; return;}
    let total=0;
    cart.forEach((it,i)=>{
      const div=document.createElement("div"); div.className="cart-item";
      const sub=(it.harga||0)*(it.qty||1); total+=sub;
      div.innerHTML=`${it.nama} x${it.qty} = ${formatCurrency(sub)}`;
      const rm=document.createElement("button"); rm.textContent="√ó"; rm.className="remove-btn"; rm.onclick=()=>{cart.splice(i,1);updateCart();};
      div.appendChild(rm); preview.appendChild(div);
    });
    el("cartTotal").textContent="Total:"+formatCurrency(total);
  }
  function tambahKeCart(r){ const i=cart.findIndex(x=>x.nama===r.nama); if(i>=0) cart[i].qty++; else cart.push({...r,qty:1}); updateCart(); }

  // ---------- SETUP ----------
  function setupTabs(){
    document.querySelectorAll(".tabs button").forEach(btn=>{
      btn.onclick=()=>{
        document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        document.querySelectorAll(".grid").forEach(g=>g.classList.add("hidden"));
        el(btn.dataset.target).classList.remove("hidden");
      };
    });
  }
  function setupLocaleSelect(){
    el("localeSelect").onchange=()=>{
      const v=el("localeSelect").value;
      if(v==="auto"){ currentLocale=navigator.language; currentCurrency="IDR"; }
      else { [currentLocale,currentCurrency]=v.split("|"); }
      tampilkanData(); updateCart();
    };
  }

  // ---------- INIT ----------
  document.addEventListener("DOMContentLoaded",async()=>{
    applyTheme();
    el("darkToggle").onclick=toggleDark;
    setupTabs(); setupLocaleSelect();
    el("loadingIndicator").style.display="block";
    await initDB();
    restoData=await loadDataFromDB();
    el("loadingIndicator").style.display="none";
    tampilkanData();
    updateCart();
  });
})();
</script>
</body>
</html>
