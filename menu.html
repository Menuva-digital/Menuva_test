
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Menu</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #1e3c72, #2a5298); /* biru elegan */
      margin: 0 0 70px 0; /* kasih space bawah utk fixed bar */
    }
    h1 {
      text-align: center;
      margin-bottom: 5px;
      color: #ddd;
    }
    .logo-resto {
      display: block;
      max-height: 80px;
      margin: 0 auto 10px;
    }
    .nama-resto {
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .section-title {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
    }
    .warning {
      color: #e74c3c;
      text-align: center;
      margin-bottom: 20px;
    }
    .promo-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 40px;
      justify-content: center;
    }
    .promo-item {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      width: 275px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      position: relative;
    }
    .promo-item img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    .promo-item h3 {
      margin: 0 0 6px 0;
      font-size: 16px;
    }
    .promo-item p {
      font-size: 14px;
      color: #555;
      margin: 0 0 10px 0;
    }
    .promo-item button {
      background: #28a745;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
    }
    .promo-item button:hover {
      background: #218838;
    }
    .promo-badge {
  position: absolute;
  top: 10px;
  left: 10px;
  background: #ffcc00;
  color: #222;
  font-weight: 800;
  font-size: 13px;
  padding: 4px 10px;
  border-radius: 999px;
  text-transform: uppercase;
  box-shadow: 0 2px 6px rgba(0,0,0,.25);
  pointer-events: none;
}
    .flipbook-section {
  margin-bottom: 40px;
}

.flipbook-gallery {
  display: flex;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  scroll-behavior: smooth;
  gap: 10px;
  padding: 10px;
  -webkit-overflow-scrolling: touch;
  scroll-padding: 0 10px;
}

.flipbook-gallery img {
  width: auto;
  max-width: 80vw;       /* default untuk layar besar */
  max-height: 70vh;
  height: auto;
  object-fit: cover;
  scroll-snap-align: center;
  flex-shrink: 0;
  border-radius: 10px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.flipbook-gallery img:active {
  transform: scale(0.97);
}

/* üì± Mobile (layar kecil < 600px) */
@media (max-width: 600px) {
  .flipbook-gallery img {
    max-width: 90vw;   /* biar lebih besar di HP */
    max-height: 50vh;  /* jangan terlalu tinggi */
  }
}

/* üì≤ Tablet (600px ‚Äì 992px) */
@media (min-width: 600px) and (max-width: 992px) {
  .flipbook-gallery img {
    max-width: 85vw;
    max-height: 60vh;
  }
}

/* üíª Desktop (992px ke atas) */
@media (min-width: 992px) {
  .flipbook-gallery img {
    max-width: 70vw;   /* lebih kecil biar elegan */
    max-height: 75vh;
  }
}

  /* fullscreen overlay */
    .fullscreen-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.85);
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }

  .fullscreen-overlay img {
    max-width: 95vw;
    max-height: 90vh;
    border-radius: 10px;
    transition: transform 0.3s ease;
    cursor: zoom-out;
    touch-action: pan-x pan-y;
  }

  /* Tombol close */
  .fullscreen-overlay .close-btn {
    position: absolute;
    top: 20px;
    right: 30px;
    font-size: 30px;
    font-weight: bold;
    color: #fff;
    cursor: pointer;
    z-index: 10000;
    user-select: none;
  }

  /* Tombol navigasi kiri/kanan */
  .fullscreen-overlay .nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 40px;
    font-weight: bold;
    color: #fff;
    cursor: pointer;
    user-select: none;
    padding: 10px;
    background: rgba(0,0,0,0.4);
    border-radius: 50%;
  }
  .fullscreen-overlay .prev-btn { left: 20px; }
  .fullscreen-overlay .next-btn { right: 20px; }
    
    .section-title {
      text-align: center;
      font-weight: bold;
      font-size: 20px;
      margin: 30px 0 20px;
      position: relative;
      display: inline-block;
      left: 50%;
      transform: translateX(-50%);
      border-bottom: 2px solid #ccc;
      padding-bottom: 5px;
    }
    .countdown {
      font-size: 14px;
      margin-bottom: 10px;
      color: #ff5733;
      font-weight: bold;
    }
    .promo-item img {
  width: 100%;
  height: auto;
  object-fit: contain; /* <--- ini penting */
  border-radius: 10px;
  display: block;
  margin: 0 auto;
}
     #infoResto {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 20px auto;
    padding: 10px 20px;
    max-width: 500px;
    text-align: center;
    border: 1px solid #eee;
    border-radius: 8px;
    background-color: #f9f9f9;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    font-size: 15px;
    color: #333;
  }

  #infoResto p {
    margin: 5px 0;
    line-height: 1.5;
  }
  /* ===================== Fixed Button Bar ===================== */
.fixed-bar {
  position: fixed;
  bottom: 0;
  left: 0;         /* pastikan nempel kiri */
  right: 0;        /* biar full sampai kanan */
  width: 93%;     /* full width */
  background: linear-gradient(135deg, #1e3c72, #2a5298);
  box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
  display: flex;
  justify-content: center;
  gap: 10px;
  padding: 10px;
  z-index: 1000;
}

.fixed-bar button {
  flex: 1;
  height: 50px;
  font-size: 14px;
  font-weight: bold;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  color: white;
  text-align: center;
  padding-top: 6px;   /* tambahin padding atas */
  line-height: normal; /* reset line-height biar nggak pakai trik 50px */
  transition: background-color 0.3s ease;
}
.btn-order { background: #007bff; }
.btn-room  { background: #28a745; }

/* Warna tombol */
.btn-book {
  display: block;             /* biar bisa atur margin auto */
  margin: 20px auto;          /* center horizontal */
  width: 80%;                 /* panjang 80% dari body */
  padding: 16px;              /* bikin agak besar */
  font-size: 1.2rem;          /* teks lebih gede */
  text-align: center;
  background: #6c63ff;
  color: #fff;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: background 0.3s ease;
}

.btn-book:hover {
  background: #5848e3; /* efek hover */
}
/* Hover effect */
.fixed-bar button:hover { opacity: 0.85; }

/* Padding bawah konten supaya tidak tertutup bar */
main, .container { padding-bottom: 70px; }

/* ===================== Mobile View ===================== */
@media (max-width: 480px) {
  .fixed-bar {
    flex-direction: row; /* tetap row */
    padding: 8px 15px;   /* pastikan ada jarak kiri/kanan */
    gap: 5px;            /* jarak antar tombol */
  }
  .fixed-bar button {
    font-size: 14px;
    padding: 10px 0;
  }
}

   .flipbook-gallery img {
  border: 2px solid #ccc;        /* Outline abu-abu terang */
  border-radius: 6px;            /* Ujung agak bulat */
  padding: 2px;                  /* Jarak sedikit antara gambar dan border */
  box-sizing: border-box;        /* Biar padding gak ngubah ukuran total */
}
    .flipbook-gallery img:hover {
  border-color: #28a745;
  box-shadow: 0 0 6px rgba(40, 167, 69, 0.5);
}
.btn-book {
  background-color: #ffc107;
}
.btn-book:hover {
  background-color: #e0a800;
}

  </style>
</head>
<body>

<!-- Logo dan Nama Restoran -->
<img id="logoResto" class="logo-resto" src="" alt="Logo Restoran" />
<h1 id="namaRestoDisplay"></h1>
 <div id="infoResto">
  <p id="alamatResto">üìç Adress: </p>
  <p id="teleponResto">üìû Telephone: </p>
</div>
</div>

<!-- Promo Section -->
<section class="flipbook-section" id="promoSection">
  <h1 class="section-title">üéâ Promo Special</h1>
  <div id="promoContainer" class="promo-grid"></div>
  <div id="promoWarning" class="warning"></div>
</section>

<!-- Flipbook Ruangan -->
<section class="flipbook-section" id="flipbookRuanganSection">
  <h1 class="section-title">üì∏ Room Galery</h1>
  <div id="flipbookRuanganGallery" class="flipbook-gallery"></div>
  <div id="ruanganWarning" class="warning"></div>
</section>

<!-- Flipbook Menu -->
<section class="flipbook-section" id="flipbookMenuSection">
  <h1 class="section-title">üìñ Menu Galery</h1>
  <div id="flipbookMenuGallery" class="flipbook-gallery"></div>
  <div id="menuWarning" class="warning"></div>
</section>

 <div class="fullscreen-overlay" id="fullscreenOverlay">
  <span class="close-btn" onclick="closeFullscreen()">‚úñ</span>
  <span class="nav-btn prev-btn" onclick="showPrev()">‚ü®</span>
  <img id="fullscreenImage" alt="Fullscreen Image" />
  <span class="nav-btn next-btn" onclick="showNext()">‚ü©</span>
</div>
  
 <button class="btn-book" onclick="window.location.href='book.html'">üìñ Dine-in Menu</button>
  
<div class="fixed-bar">
  <button class="btn-order" onclick="window.location.href='order.html'">üõí Reserve</button>
  <button class="btn-room" onclick="window.location.href='room.html'">üè¢ Room & Package</button>
</div>
<script>
const DB_NAME = "MenuvaDB";
const STORE_NAME = "menuvaData";

// ====================== Ambil restoId dari URL ======================
function getDataFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get("resto"); // ?resto=xxx
}

// ====================== Ambil data dari IndexedDB ======================
function loadDataFromDB(restoId) {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(DB_NAME, 2);

    request.onerror = () => reject("‚ùå Failed open database IndexedDB.");

    request.onsuccess = (event) => {
      const db = event.target.result;
      try {
        const tx = db.transaction(STORE_NAME, "readonly");
        const store = tx.objectStore(STORE_NAME);

        // ‚úÖ ambil berdasarkan restoId, bukan hardcode "main"
        const getReq = store.get(restoId);

        getReq.onsuccess = () => {
          const data = getReq.result;
          if (!data) return resolve(null);
          resolve(data);
        };

        getReq.onerror = () => reject("‚ùå Failed read data from object store.");
      } catch (e) {
        reject("‚ùå Error: " + e.message);
      }
    };

    request.onupgradeneeded = (event) => {
      const db = event.target.result;
      if (!db.objectStoreNames.contains(STORE_NAME)) {
        db.createObjectStore(STORE_NAME, { keyPath: "restoId" });
      }
    };
  });
}

// ====================== Render fungsi yg sudah ada ======================
function renderFlipbookGallery(containerId, images, warningId) {
  const container = document.getElementById(containerId);
  const warning = document.getElementById(warningId);
  container.innerHTML = "";
  warning.textContent = "";

  if (!images || images.length === 0) {
    warning.textContent = "No pictures.";
    return;
  }

  images.forEach(src => {
    const img = document.createElement("img");
    img.src = src;
    img.alt = "Flipbook Image";
    img.onclick = () => openFullscreen(src);
    container.appendChild(img);
  });
}

function openFullscreen(src) {
  const overlay = document.getElementById("fullscreenOverlay");
  const img = document.getElementById("fullscreenImage");
  img.src = src;
  overlay.style.display = "flex";
}

function closeFullscreen() {
  document.getElementById("fullscreenOverlay").style.display = "none";
  document.getElementById("fullscreenImage").src = "";
}

function renderPromo(promoList) {
  const promoContainer = document.getElementById("promoContainer");
  promoContainer.innerHTML = "";

  if (!promoList || promoList.length === 0) {
    document.getElementById("promoWarning").textContent = "‚ùå No promo data available.";
    return;
  }

  promoList.forEach((promo, index) => {
    const promoCard = document.createElement("div");
    promoCard.className = "promo-item";

    const badge = document.createElement("div");
    badge.className = "promo-badge";
    badge.textContent = promo.badge || "Promo";
    promoCard.appendChild(badge);

    const img = document.createElement("img");
    img.src = promo.image;
    img.alt = promo.namaMenu;
    promoCard.appendChild(img);

    const title = document.createElement("h3");
    title.textContent = promo.namaMenu;
    promoCard.appendChild(title);

    const desc = document.createElement("p");
    desc.textContent = promo.deskripsi;
    promoCard.appendChild(desc);

    const price = document.createElement("div");
    price.className = "promo-price";
    price.textContent = ` ${parseInt(promo.harga).toLocaleString("id-ID")}`;
    promoCard.appendChild(price);

    const countdown = document.createElement("div");
    countdown.className = "countdown";
    countdown.id = `countdown-${index}`;
    promoCard.appendChild(countdown);

    promoContainer.appendChild(promoCard);

    if (promo.tanggalAkhir) {
      startCountdown(promo.tanggalAkhir, countdown.id);
    } else {
      countdown.textContent = "Tanpa batas waktu";
    }
  });
}

function startCountdown(tanggalAkhir, elementId) {
  function updateCountdown() {
    const deadline = new Date(tanggalAkhir).getTime();
    const now = new Date().getTime();
    const distance = deadline - now;

    const el = document.getElementById(elementId);
    if (!el) return;

    if (distance < 0) {
      el.textContent = "Promotion has ended";
      return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    el.textContent = `Ends in : ${days}.d ${hours}.h ${minutes}.m ${seconds}.s`;
  }

  updateCountdown();
  setInterval(updateCountdown, 1000);
}

// ====================== Window onload ======================
window.onload = async () => {
  const restoId = getDataFromURL();

  if (!restoId) {
    alert("‚ùå Resto ID tidak ditemukan di URL. Gunakan ?resto=xxxx");
    return;
  }

  try {
    const data = await loadDataFromDB(restoId);

    if (!data) {
      console.warn("‚ö†Ô∏è Tidak ada data ditemukan di IndexedDB untuk restoId:", restoId);
      return;
    }

    // --- Render resto ---
    const logoElem = document.getElementById("logoResto");
    if (data.logo) {
      logoElem.src = data.logo;
      logoElem.style.display = "block";
    } else {
      logoElem.style.display = "none";
    }

    document.getElementById("namaRestoDisplay").textContent = data.namaRestoran || "Menu Restoran";
    document.getElementById("alamatResto").innerText = `üìç Address: ${data.restoAddress || '-'}`;
    document.getElementById("teleponResto").innerText = `üìû Telephone: ${data.restoPhone || '-'}`;

    renderPromo(data.menuPromo);
    renderFlipbookGallery("flipbookRuanganGallery", data.flipbookRuanganImages, "ruanganWarning");
    renderFlipbookGallery("flipbookMenuGallery", data.flipbookMenuImages, "menuWarning");

  } catch (err) {
    console.error(err);
    alert("Gagal load data menu.");
  }
};
  
  async function watchDBChanges() {
  let lastData = null;

  async function checkUpdates() {
    const db = await openDB();
    const tx = db.transaction("resto", "readonly");
    const store = tx.objectStore("resto");
    const all = await store.getAll();
    await tx.done;

    const dataStr = JSON.stringify(all);
    if (dataStr !== lastData) {
      lastData = dataStr;
      console.log("üîÑ Data changed, refreshing view...");
      renderMenu(all); // panggil fungsi render ulang
    }
  }

  // cek pertama kali
  await checkUpdates();

  // polling setiap 3 detik
  setInterval(checkUpdates, 3000);
}

// panggil saat halaman load
document.addEventListener("DOMContentLoaded", watchDBChanges);

 let galleryImages = [];
  let currentIndex = 0;

  // buka fullscreen dengan index
  function openFullscreen(src, index = 0, allImages = []) {
    galleryImages = allImages;
    currentIndex = index;

    const overlay = document.getElementById("fullscreenOverlay");
    const img = document.getElementById("fullscreenImage");
    img.src = src;
    overlay.style.display = "flex";
  }

  function closeFullscreen() {
    const overlay = document.getElementById("fullscreenOverlay");
    const img = document.getElementById("fullscreenImage");
    overlay.style.display = "none";
    img.src = "";
    galleryImages = [];
    currentIndex = 0;
  }

  function showPrev() {
    if (!galleryImages.length) return;
    currentIndex = (currentIndex - 1 + galleryImages.length) % galleryImages.length;
    document.getElementById("fullscreenImage").src = galleryImages[currentIndex];
  }

  function showNext() {
    if (!galleryImages.length) return;
    currentIndex = (currentIndex + 1) % galleryImages.length;
    document.getElementById("fullscreenImage").src = galleryImages[currentIndex];
  }

  // ESC untuk close, ArrowLeft/ArrowRight untuk navigasi
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      closeFullscreen();
    } else if (e.key === "ArrowLeft") {
      showPrev();
    } else if (e.key === "ArrowRight") {
      showNext();
    }
  });
</script>
</body>
</html>









